# Production values for ec-keycloak - using auth.easychamp.com subdomain

replicaCount: 2

image:
  tag: "latest"

keycloak:
  database:
    host: "postgres.easychamp.com"
    port: 5432
    database: keycloak

  proxy:
    mode: edge
    headers: xforwarded

  # Extra environment variables for production (subdomain setup - no path prefix needed)
  extraEnv:
    - name: KC_HOSTNAME
      value: "auth.easychamp.com"
    - name: KC_HOSTNAME_STRICT
      value: "false"
    - name: KC_LOG_LEVEL
      value: "INFO"
    - name: JAVA_OPTS_APPEND
      value: "-Djgroups.dns.query=ec-keycloak-headless.ec-keycloak.svc.cluster.local"

resources:
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 2
    memory: 2Gi

# Ingress with TLS - using auth.easychamp.com subdomain
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
    nginx.ingress.kubernetes.io/proxy-buffers-number: "4"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: auth.easychamp.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: cloudflare-tls-secret
      hosts:
        - auth.easychamp.com

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70

podAnnotations:
  kubectl.kubernetes.io/restartedAt: "2026-02-06T07:45:00Z"

podDisruptionBudget:
  enabled: true
  minAvailable: 1
